<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>split tool| ä¸¤ä¸ªå­—é‡å¤ä¸æ ‡çº¢ï¼ä»”ç»†æ£€æŸ¥</title>
    <style>
        :root {
            --primary-color: #007aff;
            --success-color: #34c759;
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --card-bg: rgba(255, 255, 255, 0.85);
            --text-main: #1c1c1e;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-gradient: linear-gradient(135deg, #1a1c20 0%, #0f1013 100%);
                --card-bg: rgba(28, 28, 30, 0.9);
                --text-main: #f2f2f7;
            }
        }

        body, html {
            height: 100%;
            margin: 0;
            overflow: hidden;
            font-family: -apple-system, system-ui, sans-serif;
            background: var(--bg-gradient);
        }

        .app-container {
            height: 96vh;
            width: 98vw;
            margin: 2vh auto;
            background: var(--card-bg);
            backdrop-filter: blur(40px);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 50px rgba(0,0,0,0.2);
        }

        .header {
            padding: 12px 25px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .main-content {
            flex: 1;
            display: flex;
            padding: 15px;
            gap: 15px;
            overflow: hidden;
        }

        .panel { display: flex; flex-direction: column; gap: 8px; }
        .input-panel { flex: 2; } 
        .output-panel { flex: 1; }

        /* é’ˆå¯¹ 1.5m è·ç¦»ä¼˜åŒ–çš„è¶…ç²—ä½“è¾“å…¥æ¡† */
        textarea {
            flex: 1;
            width: 100%;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(0,0,0,0.1);
            background: rgba(255,255,255,0.5);
            color: var(--text-main);
            font-size: 19px; 
            font-weight: 800; /* æè‡´åŠ ç²— */
            line-height: 1.6;
            resize: none;
            outline: none;
        }

        .result-card {
            flex: 1;
            background: rgba(255,255,255,0.4);
            padding: 15px;
            border-radius: 12px;
            overflow-y: auto;
            border: 1px solid rgba(0,0,0,0.05);
            white-space: pre-wrap;
            word-break: break-all;
            font-size: 16px;
            font-weight: 700;
        }

        #links {
            flex: 0.5;
            background: rgba(0, 122, 255, 0.08);
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        /* æ ¸å¿ƒæŒ‰é’®ï¼šä¸€é”®å¤åˆ¶æå–é“¾æ¥ */
        .copy-link-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.2s;
        }
        .copy-link-btn:hover { background: #0056b3; }

        .duplicate-tag {
            padding: 0 2px;
            border-radius: 3px;
            text-decoration: underline;
        }

        .btn-small {
            background: transparent;
            border: 1px solid var(--text-main);
            color: var(--text-main);
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <span style="font-weight: 800; font-size: 18px;">ğŸ’ LinkFormatter Pro | å·¥ä½œç»ˆç«¯</span>
        <div style="font-size: 12px; opacity: 0.6;">é˜ˆå€¼: 3å­— | ç™½åå•: ç”¨è¿™ä¸ª/æ–°é“¾æ¥</div>
    </div>

    <div class="main-content">
        <div class="panel input-panel">
            <textarea id="input" placeholder="è¯·ç²˜è´´æ–‡æ¡ˆ..." oninput="process()"></textarea>
        </div>

        <div class="panel output-panel">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size: 14px; font-weight: 800;">æŸ¥é‡é¢„è§ˆ</span>
                <button class="btn-small" onclick="copyText('pureText')">å¤åˆ¶æ–‡æ¡ˆ</button>
            </div>
            <div id="pureText" class="result-card"></div>
            
            <div style="font-size: 14px; font-weight: 800; margin-top: 5px;">æå–åˆ°çš„é“¾æ¥</div>
            <div id="links" class="result-card"></div>
            
            <button class="copy-link-btn" onclick="copyText('links')">ğŸ”— ä¸€é”®å¤åˆ¶æå–çš„é“¾æ¥</button>
        </div>
    </div>
</div>

<script>
    // ç™½åå•é…ç½®
    const whitelist = ["ç”¨è¿™ä¸ª", "æ–°é“¾æ¥"];
    
    // è´¨æ„Ÿé…è‰²æ–¹æ¡ˆ
    const palette = [
        { t: "#ff3b30", b: "rgba(255, 59, 48, 0.2)" },
        { t: "#5856d6", b: "rgba(88, 86, 214, 0.2)" },
        { t: "#ff9500", b: "rgba(255, 149, 0, 0.2)" },
        { t: "#34c759", b: "rgba(52, 199, 89, 0.2)" },
        { t: "#af52de", b: "rgba(175, 82, 222, 0.2)" },
        { t: "#007aff", b: "rgba(0, 122, 255, 0.2)" }
    ];

    function process() {
        const input = document.getElementById('input').value;
        if (!input.trim()) {
            document.getElementById('pureText').innerHTML = "";
            document.getElementById('links').innerText = "";
            return;
        }

        const urlRegex = /(weixinstore[^\s\u4e00-\u9fa5]+)/g;
        const allLinks = input.match(urlRegex) || [];
        const uniqueLinks = [...new Set(allLinks)];
        
        // æ ¸å¿ƒç®—æ³•ï¼šæå–é•¿åº¦ >= 3 çš„é‡å¤æ±‰å­—ç‰‡æ®µ
        const textOnly = input.replace(urlRegex, ' ');
        const duplicates = findDuplicates(textOnly, 3);

        // é¢œè‰²æ˜ å°„
        const colorMap = {};
        duplicates.forEach((word, i) => {
            colorMap[word] = palette[i % palette.length];
        });

        // æ¸²æŸ“ HTML
        let html = input.replace(urlRegex, ' <span style="color:#007aff;opacity:0.6;">[é“¾æ¥]</span> ');
        
        // æŒ‰é•¿åº¦å€’åºæ›¿æ¢ï¼Œé˜²æ­¢å­ä¸²å¹²æ‰°é•¿ä¸²
        duplicates.sort((a, b) => b.length - a.length).forEach(word => {
            const c = colorMap[word];
            const regex = new RegExp(word, 'g');
            html = html.replace(regex, `<span class="duplicate-tag" style="color:${c.t};background:${c.b};">${word}</span>`);
        });

        document.getElementById('pureText').innerHTML = html;
        document.getElementById('links').innerText = uniqueLinks.join('\n');
    }

    // ç®—æ³•ï¼šå¯»æ‰¾é•¿åº¦è‡³å°‘ä¸º n çš„é‡å¤å­ä¸²
    function findDuplicates(text, n) {
        const counts = {};
        const found = [];
        // è¿™é‡Œé‡‡ç”¨æ»‘åŠ¨çª—å£åˆæ­¥å®šä½ï¼Œä½ å¯ä»¥æ ¹æ®å·¥ä½œå¼ºåº¦è°ƒæ•´ n çš„å¤§å°
        for (let len = n; len <= 8; len++) { // æ‰«æ 3-8 å­—é•¿åº¦çš„è¯
            for (let i = 0; i <= text.length - len; i++) {
                const sub = text.substr(i, len);
                if (/[\u4e00-\u9fa5]+/.test(sub) && !whitelist.some(w => sub.includes(w))) {
                    counts[sub] = (counts[sub] || 0) + 1;
                }
            }
        }
        for (const sub in counts) {
            if (counts[sub] > 1) {
                // ç®€å•çš„åŒ…å«å…³ç³»è¿‡æ»¤ï¼Œé¿å…é‡å¤æ ‡çº¢
                if (!found.some(f => f.includes(sub)) && !found.some(f => sub.includes(f))) {
                    found.push(sub);
                } else if (found.some(f => sub.includes(f))) {
                    // å¦‚æœå‘ç°æ›´é•¿çš„é‡å¤ä¸²ï¼Œæ›¿æ¢æ‰çŸ­çš„
                    const idx = found.findIndex(f => sub.includes(f));
                    found[idx] = sub;
                }
            }
        }
        return [...new Set(found)];
    }

    function copyText(id) {
        const text = document.getElementById(id).innerText;
        navigator.clipboard.writeText(text).then(() => {
            const btn = event.target;
            const origin = btn.innerText;
            btn.innerText = "âœ… å¤åˆ¶æˆåŠŸ";
            setTimeout(() => btn.innerText = origin, 1200);
        });
    }
</script>

</body>
</html>
