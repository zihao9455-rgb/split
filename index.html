<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkFormatter Pro | 3å­—æŸ¥é‡æ——èˆ°ç‰ˆ</title>
    <style>
        :root {
            --primary-color: #007aff;
            --danger-color: #ff3b30;
            --success-color: #34c759;
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --card-bg: rgba(255, 255, 255, 0.85);
            --text-main: #1c1c1e;
            --card-inner: #ffffff;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-gradient: linear-gradient(135deg, #1a1c20 0%, #0f1013 100%);
                --card-bg: rgba(28, 28, 30, 0.9);
                --text-main: #f2f2f7;
                --card-inner: #1c1c1e;
            }
        }

        body, html {
            height: 100%;
            margin: 0;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg-gradient);
        }

        .app-container {
            height: 96vh;
            width: 98vw;
            margin: 2vh auto;
            background: var(--card-bg);
            backdrop-filter: blur(40px);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 50px rgba(0,0,0,0.2);
        }

        .header {
            padding: 12px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .main-content {
            flex: 1;
            display: flex;
            padding: 15px;
            gap: 15px;
            overflow: hidden;
        }

        .panel { display: flex; flex-direction: column; gap: 8px; }
        .input-panel { flex: 2; } 
        .output-panel { flex: 1.1; }

        .label-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 800;
            color: var(--text-main);
            font-size: 15px;
        }

        /* é’ˆå¯¹è¿œè·ç¦»è§‚çœ‹ä¼˜åŒ–çš„è¾“å…¥æ¡† */
        textarea {
            flex: 1;
            width: 100%;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(0,0,0,0.1);
            background: var(--card-inner);
            color: var(--text-main);
            font-size: 19px; 
            font-weight: 800; 
            line-height: 1.7;
            resize: none;
            outline: none;
            box-sizing: border-box;
            transition: all 0.2s;
        }
        textarea:focus { border-color: var(--primary-color); box-shadow: 0 0 0 4px rgba(0,122,255,0.1); }

        .result-card {
            flex: 1;
            background: var(--card-inner);
            padding: 15px;
            border-radius: 12px;
            overflow-y: auto;
            border: 1px solid rgba(0,0,0,0.05);
            white-space: pre-wrap;
            word-break: break-all;
            font-size: 17px;
            font-weight: 800;
            line-height: 1.7;
        }

        #links {
            flex: 0.6;
            background: rgba(0, 122, 255, 0.08);
            color: var(--primary-color);
            border: 1px dashed var(--primary-color);
        }

        /* æ ¸å¿ƒåŠ¨ä½œæŒ‰é’® */
        .copy-link-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 122, 255, 0.3);
            transition: transform 0.1s;
        }
        .copy-link-btn:active { transform: scale(0.97); }

        .duplicate-tag {
            padding: 0 2px;
            border-radius: 4px;
            text-decoration: underline;
        }

        .secondary-btn {
            background: rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.1);
            color: var(--text-main);
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <span style="font-size: 20px; font-weight: 900;">ğŸš€ä»…ä¸¤ä¸ªå­—é‡å¤ä¸æ ‡çº¢ï¼ï¼ï¼</span>
        <div style="display: flex; gap: 10px; align-items: center;">
            <span style="font-size: 12px; opacity: 0.5;">ç™½åå•: ç”¨è¿™ä¸ªã€æ–°é“¾æ¥</span>
            <button class="secondary-btn" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©ºå†…å®¹</button>
        </div>
    </div>

    <div class="main-content">
        <div class="panel input-panel">
            <div class="label-row">
                <span>æ–‡æ¡ˆè¾“å…¥åŒº</span>
                <span id="stat" style="font-size: 12px; opacity: 0.5;">ç­‰å¾…ç²˜è´´...</span>
            </div>
            <textarea id="input" placeholder="åœ¨æ­¤ç²˜è´´åŸå§‹æ–‡æ¡ˆ..." oninput="process()"></textarea>
        </div>

        <div class="panel output-panel">
            <div class="label-row">
                <span>æŸ¥é‡é¢„è§ˆ (3å­—ä»¥ä¸Šé‡å¤æ ‡è‰²)</span>
                <button class="secondary-btn" onclick="copyText('pureText')">å¤åˆ¶ç»“æœ</button>
            </div>
            <div id="pureText" class="result-card"></div>
            
            <div class="label-row" style="margin-top: 10px;">
                <span>æå–åˆ°çš„é“¾æ¥</span>
            </div>
            <div id="links" class="result-card"></div>
            
            <button class="copy-link-btn" onclick="copyText('links')">ğŸ”— ä¸€é”®å¤åˆ¶æå–çš„é“¾æ¥</button>
        </div>
    </div>
</div>

<script>
    // 1. ç™½åå•é…ç½®
    const whitelist = ["ç”¨è¿™ä¸ª", "æ–°é“¾æ¥"];
    
    // 2. è´¨æ„Ÿé…è‰²
    const colorPalette = [
        { t: "#ff3b30", b: "rgba(255, 59, 48, 0.2)" },
        { t: "#5856d6", b: "rgba(88, 86, 214, 0.2)" },
        { t: "#ff9500", b: "rgba(255, 149, 0, 0.2)" },
        { t: "#34c759", b: "rgba(52, 199, 89, 0.2)" },
        { t: "#af52de", b: "rgba(175, 82, 222, 0.2)" },
        { t: "#5ac8fa", b: "rgba(90, 200, 250, 0.2)" }
    ];

    function clearAll() {
        document.getElementById('input').value = "";
        process();
    }

    function process() {
        const input = document.getElementById('input').value;
        document.getElementById('stat').innerText = `å·²è¾“å…¥ ${input.length} å­—`;
        
        if (!input.trim()) {
            document.getElementById('pureText').innerHTML = "";
            document.getElementById('links').innerText = "";
            return;
        }

        // æå–é“¾æ¥
        const urlRegex = /(weixinstore[^\s\u4e00-\u9fa5]+)/g;
        const allLinks = input.match(urlRegex) || [];
        const uniqueLinks = [...new Set(allLinks)];
        
        // æ ¸å¿ƒç®—æ³•ï¼šæå–é•¿åº¦ >= 3 çš„é‡å¤æ±‰å­—ç‰‡æ®µ
        const textOnly = input.replace(urlRegex, ' ');
        const duplicates = findDuplicates(textOnly, 3);

        // å»ºç«‹é¢œè‰²æ˜ å°„
        const colorMap = {};
        duplicates.forEach((word, i) => {
            colorMap[word] = colorPalette[i % colorPalette.length];
        });

        // æ¸²æŸ“å¤„ç†ç»“æœ
        let html = input.replace(urlRegex, ' <span style="color:#007aff; opacity:0.6;">[é“¾æ¥]</span> ');
        
        // æŒ‰é•¿åº¦å€’åºæ›¿æ¢ï¼Œé˜²æ­¢å­ä¸²å¹²æ‰°é•¿ä¸²ï¼ˆä¾‹å¦‚é‡å¤äº†â€œç¾Šèƒç´ ç²¾åâ€ï¼Œåˆ™ä¸å•ç‹¬æ ‡çº¢â€œç¾Šèƒç´ â€ï¼‰
        duplicates.sort((a, b) => b.length - a.length).forEach(word => {
            const c = colorMap[word];
            const regex = new RegExp(word, 'g');
            html = html.replace(regex, `<span class="duplicate-tag" style="color:${c.t}; background:${c.b};">${word}</span>`);
        });

        document.getElementById('pureText').innerHTML = html;
        document.getElementById('links').innerText = uniqueLinks.join('\n');
    }

    // æ»‘åŠ¨çª—å£æŸ¥æ‰¾é‡å¤é¡¹ç®—æ³•
    function findDuplicates(text, minLen) {
        const counts = {};
        const results = [];
        
        // æ‰«æé•¿åº¦ä» minLen åˆ° 10 çš„æ‰€æœ‰å¯èƒ½è¯ç»„
        for (let len = minLen; len <= 10; len++) {
            for (let i = 0; i <= text.length - len; i++) {
                const sub = text.substr(i, len);
                // ä»…åŒ¹é…çº¯æ±‰å­—ï¼Œä¸”ä¸åœ¨ç™½åå•å†…
                if (/^[\u4e00-\u9fa5]+$/.test(sub) && !whitelist.some(w => sub.includes(w))) {
                    counts[sub] = (counts[sub] || 0) + 1;
                }
            }
        }

        // æ‰¾å‡ºå‡ºç°æ¬¡æ•° > 1 çš„è¯
        const allDups = Object.keys(counts).filter(k => counts[k] > 1);
        
        // è¿‡æ»¤åŒ…å«å…³ç³»ï¼šå¦‚æœâ€œç¾Šèƒç´ ç²¾åâ€é‡å¤äº†ï¼Œå°±ä¸éœ€è¦å•ç‹¬æ˜¾ç¤ºâ€œç¾Šèƒç´ â€é‡å¤
        allDups.sort((a, b) => b.length - a.length).forEach(word => {
            if (!results.some(r => r.includes(word))) {
                results.push(word);
            }
        });
        
        return results;
    }

    function copyText(id) {
        const text = document.getElementById(id).innerText;
        navigator.clipboard.writeText(text).then(() => {
            const btn = event.target;
            const original = btn.innerText;
            btn.innerText = "âœ… æˆåŠŸï¼";
            setTimeout(() => btn.innerText = original, 1200);
        });
    }
</script>

</body>
</html>
